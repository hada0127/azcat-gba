# GBA 기술 스펙

## 하드웨어 제약

| 항목 | 값 |
|------|-----|
| 해상도 | 240×160 |
| CPU | ARM7TDMI 16.78MHz |
| VRAM | 96KB |
| OAM | 128 스프라이트 |
| 팔레트 | BG 256색 + OBJ 256색 (16색×16뱅크) |
| SRAM | 32KB (세이브용) |

## 그래픽 모드

- **Mode 4**: 8bpp 팔레트 비트맵 (240×160)
  - 더블 버퍼링 가능 (page flip: 0x06000000 / 0x0600A000)
  - 배경당 256색 팔레트
  - VRAM 1프레임 = 0x9600 bytes

## 레이아웃 (240×160)

```
┌──────────────────────────────┐
│  SCORE:0000   [얼굴][폭탄]  │ ← HUD (16px)
├──────────────────────────────┤
│                              │
│      게임 영역 (240×144)     │
│                              │
│      ─── 플레이어 ───        │
│══════════════ 바닥 ══════════│
└──────────────────────────────┘
```

## 좌표 매핑 (원본 → GBA)

| 항목 | 원본 | GBA | 비고 |
|------|------|-----|------|
| 해상도 | 320×240 | 240×160 | |
| 게임 영역 폭 | 210px | 240px | 풀스크린 |
| 게임 영역 높이 | ~240px | 144px | HUD 16px 제외 |
| 플레이어 X 범위 | 0~189 | 0~216 | 스프라이트 24px 감안 |
| 플레이어 초기 X | 93 | 108 | 화면 중앙 |
| 고양이 스폰 X | 1~205 | 1~224 | |
| 고양이 스폰 Y | -32~-192 | -20~-120 | |
| 고양이 착지 Y | 200 | 136 | |
| 충돌 판정 Y | 170~190 | 116~136 | |
| 아이템 착지 Y | 207 | 140 | |
| 바닥 Y | ~210 | 144 | |

## OAM 스프라이트 할당 계획

| 인덱스 | 용도 | 크기 | 수량 |
|--------|------|------|------|
| 0 | 플레이어 | 32×32 | 1 |
| 1~33 | 고양이 | 16×16 | 33 |
| 34 | 아이템 | 16×16 | 1 |
| 35 | 폭발 이펙트 | 32×32 | 1 |
| 36 | 캐릭터 얼굴 (HUD) | 32×32 | 1 |
| 37 | 폭탄 아이콘 (HUD) | 16×16 | 1 |
| **합계** | | | **~38** |

## 고정소수점 연산

- **.8 fixed point**: 상위 24bit 정수, 하위 8bit 소수
- `#define FP_SHIFT 8`
- `#define FP(x) ((x) << FP_SHIFT)`
- `#define FP_TO_INT(x) ((x) >> FP_SHIFT)`
- 곱셈 시 오버플로 주의: `(a * b) >> FP_SHIFT`

## 프레임 루프

```c
// VBlank 대기 → 입력 처리 → 로직 업데이트 → 렌더링
while(1) {
    VBlankIntrWait();
    key_poll();
    // page flip (Mode 4 더블버퍼)
    update();
    render();
    vid_flip();
}
```

## SRAM 세이브 구조

```c
typedef struct {
    u32 magic;      // 0x415A4341 ("AZCA")
    u32 hiscore;
    u8  checksum;
} SaveData;
```

## 주의사항

- VRAM 쓰기는 16bit 단위 (8bit 쓰기 불가 → 바이트 단위 쓸 때 16bit read-modify-write)
- OAM 업데이트는 VBlank 중에만
- Mode 4에서 홀수 X좌표 픽셀 쓸 때 인접 픽셀과 함께 16bit 써야 함
- DMA 전송 활용하면 배경 복사 고속화 가능
